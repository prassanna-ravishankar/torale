import React, { useState, useEffect, useRef } from 'react';

/*
 * =======================================================================
 * STYLE & UTILITIES
 * =======================================================================
 */
const StyleInjector = () => (
  <style>
    {`
      .perspective-1000 {
        perspective: 1000px;
      }
      .transform-style-3d {
        transform-style: preserve-3d;
      }
      
      /* Simple keyframe animation for the subtitle text fading in */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out forwards;
      }

      /* --- NEW VISUAL ANIMATIONS --- */

      /* 1. Foundation: Live Grid Flicker */
      @keyframes flicker {
        0%, 100% { opacity: 0.2; }
        20% { opacity: 1; background-color: #f87171; } /* red-300 */
        30% { opacity: 0.4; }
        50% { opacity: 0.8; background-color: #fca5a5; } /* red-200 */
        70% { opacity: 0.3; }
      }
      .animate-flicker {
        animation: flicker 4s infinite;
      }

      /* 2. Acquisition: Data Pillar Rise */
      @keyframes rise {
        from { transform: scaleY(0.05); }
        to { transform: scaleY(1); }
      }
      .animate-rise {
        transform-origin: bottom;
        animation: rise 3s infinite alternate ease-in-out;
      }
      
      /* 3. Reasoning: CPU Tracer */
      @keyframes trace-x {
        from { transform: translateX(-100%); }
        to { transform: translateX(400%); }
      }
      @keyframes trace-y {
        from { transform: translateY(-100%); }
        to { transform: translateY(400%); }
      }
      .animate-trace-x {
        animation: trace-x 2s linear infinite;
      }
      .animate-trace-y {
        animation: trace-y 1.8s linear infinite;
      }

      /* 4. Signal: Pulse & Ring */
      @keyframes pulse-core {
        0%, 100% { opacity: 0.7; transform: scale(0.95); }
        50% { opacity: 1; transform: scale(1.05); }
      }
      .animate-pulse-core {
        animation: pulse-core 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      @keyframes signal-ring {
        from {
          transform: scale(0.5);
          opacity: 0.7;
        }
        to {
          transform: scale(2.5);
          opacity: 0;
        }
      }
      .animate-signal {
        animation: signal-ring 2.5s ease-out infinite;
      }
    `}
  </style>
);

/*
 * =======================================================================
 * LAYER VISUALS (PLACEHOLDERS) - NEW CREATIVE VERSIONS
 * =======================================================================
 */

// A base component for each layer to share the 3D transform and styling
const LayerBase = ({ className, ...props }) => (
  <div
    className={`
      w-64 h-64 rounded-xl border-2 bg-white/50 backdrop-blur-sm
      transition-all duration-700 ease-in-out transform-style-3d
      absolute overflow-hidden
      ${className}
    `}
    style={{ transform: 'rotateX(60deg) rotateZ(-45deg)' }}
    {...props}
  />
);

// 1. Foundation: Live Data Grid
const FoundationVisual = () => (
  <div className="w-full h-full p-3 grid grid-cols-6 gap-1.5">
    {Array.from({ length: 36 }).map((_, i) => (
      <div
        key={i}
        className="w-full h-full bg-gray-300 rounded-sm opacity-20 animate-flicker"
        style={{ animationDelay: `${Math.random() * 4}s` }}
      />
    ))}
  </div>
);

// 2. Acquisition: Rising Data Pillars
const AcquisitionVisual = () => (
  <div className="w-full h-full p-4 grid grid-cols-3 gap-4">
    {Array.from({ length: 9 }).map((_, i) => (
      <div
        key={i}
        className="w-full h-full bg-gray-400 rounded-t-md animate-rise"
        style={{
          animationDelay: `${i * 0.2}s`,
          animationDuration: `${2 + Math.random() * 2}s`
        }}
      />
    ))}
  </div>
);

// 3. Reasoning: Active CPU
const ReasoningVisual = () => (
  <div className="w-full h-full flex items-center justify-center p-4 relative">
    {/* Tracers */}
    <div className="absolute top-1/3 left-0 w-1/4 h-0.5 bg-red-400 animate-trace-x" style={{animationDelay: '0s'}} />
    <div className="absolute top-1/2 left-0 w-1/4 h-0.5 bg-red-400 animate-trace-x" style={{animationDelay: '0.5s'}} />
    <div className="absolute top-2/3 left-0 w-1/4 h-0.5 bg-red-400 animate-trace-x" style={{animationDelay: '0.2s'}} />
    <div className="absolute left-1/3 top-0 w-0.5 h-1/4 bg-red-400 animate-trace-y" style={{animationDelay: '0.7s'}} />
    <div className="absolute left-2/3 top-0 w-0.5 h-1/4 bg-red-400 animate-trace-y" style={{animationDelay: '0.3s'}} />

    {/* Chip Body */}
    <div className="w-3/4 h-3/4 bg-gray-700 rounded-lg relative flex items-center justify-center shadow-inner">
      {/* Etchings */}
      <div className="absolute w-[90%] h-[90%] border border-gray-600 rounded-md" />
      <div className="absolute w-[80%] h-[80%] border border-gray-600 rounded-md" />
      
      {/* Core */}
      <div className="w-1/2 h-1/2 bg-gray-500 rounded-md relative z-10 animate-pulse-core shadow-lg" />
      
      {/* Pins */}
      {Array.from({ length: 8 }).map((_, i) => (
        <div
          key={i}
          className="absolute w-2 h-5 bg-gray-600 z-0"
          style={{
            top: '50%',
            left: '50%',
            transformOrigin: 'top left',
            transform: `rotate(${i * 45}deg) translate(61px, -4px)`,
          }}
        />
      ))}
    </div>
  </div>
);

// 4. Signal: Beacon
const SignalVisual = () => (
  <div className="w-full h-full flex items-center justify-center relative">
    {/* Signal Rings */}
    <div className="absolute w-16 h-16 rounded-full border-2 border-red-400/70 animate-signal" style={{ animationDelay: '0s' }} />
    <div className="absolute w-16 h-16 rounded-full border-2 border-red-400/70 animate-signal" style={{ animationDelay: '1.25s' }} />
    
    {/* Central Beacon */}
    <div className="w-8 h-8 rounded-full bg-red-400 opacity-90 z-10 animate-pulse-core shadow-[0_0_20px_10px_rgba(239,68,68,0.4)]" />
  </div>
);

/*
 * =======================================================================
 * VISUAL PANE (Left Side)
 * =======================================================================
 */
const VisualPane = ({ activeScene }) => {
  // Updated colors to match the new light theme
  const getLayerStyle = (layerNumber) => {
    if (activeScene === 1) {
      // Neutral "stacked" state
      return 'opacity-60 scale-90 border-gray-400';
    }
    if (activeScene === layerNumber + 1) {
      // Active (highlighted) state (using red accent)
      return 'opacity-100 scale-100 z-10 border-red-400 shadow-2xl shadow-red-400/30';
    }
    // Inactive state
    return 'opacity-30 scale-90 border-gray-300';
  };

  return (
    // Updated background
    <div className="md:w-1/2 w-full h-full flex items-center justify-center relative overflow-hidden">
      <div className="absolute inset-0 bg-radial-gradient from-gray-200/10 to-gray-100" />
      
      <div className="relative w-64 h-64 perspective-1000">
        <LayerBase
          className={`${getLayerStyle(1)} translate-y-[-60px]`}
        >
          <FoundationVisual />
        </LayerBase>
        <LayerBase
          className={`${getLayerStyle(2)} translate-y-[-20px]`}
        >
          <AcquisitionVisual />
        </LayerBase>
        <LayerBase className={`${getLayerStyle(3)} translate-y-[20px]`}>
          <ReasoningVisual />
        </LayerBase>
        <LayerBase className={`${getLayerStyle(4)} translate-y-[60px]`}>
          <SignalVisual />
        </LayerBase>
      </div>
    </div>
  );
};

/*
 * =======================================================================
 * TEXT PANE (Right Side)
 * =======================================================================
 */

// REWORDED scenes array (content unchanged)
const scenes = [
  {
    id: 1,
    title: 'Monitoring is a system.',
    subtitle:
      'Torale runs scheduled searches, LLM analysis, and notifications as a unified, automated system in your cloud.',
  },
  {
    id: 2,
    title: 'Foundation: Task & Schedule',
    subtitle:
      'Define your intent. Your search query, condition, and cron schedule form the solid foundation for the entire monitoring task.',
  },
  {
    id: 3,
    title: 'Acquisition: Grounded Search',
    subtitle:
      'At your scheduled time, Torale executes a grounded Google Search, pulling in real-time, unstructured data from the live web.',
  },
  {
    id: 4,
    title: 'Reasoning: LLM Analysis',
    subtitle:
      "The LLM 'brain' reasons over the search results, evaluating the raw data against your specific condition to find a match.",
  },
  {
    id: 5,
    title: 'Signal: Conditional Notification',
    subtitle:
      "You get the signal. A single, actionable alert is sent *only* when your condition is met. No noise, just the answer you're waiting for.",
  },
];

// Reusable Corner Bracket Component
const CornerBracket = ({ className }) => (
  <div className={`absolute w-3 h-3 border-red-400 ${className}`} />
);

const TextPane = ({ activeScene }) => {
  const activeSceneData = scenes.find((s) => s.id === activeScene);

  return (
    <div className="md:w-1/2 w-full h-full flex items-center justify-center">
      <div className="w-full max-w-lg p-8 flex flex-col justify-center">
        {/* Render all titles */}
        <div className="space-y-6 mb-10">
          {scenes.map((scene) => {
            const isActive = scene.id === activeScene;
            return (
              <div key={scene.id} className="flex items-center group relative">
                
                {/* --- NEW CORNER BRACKETS (from inspiration) --- */}
                {/* Show only if active */}
                <CornerBracket className={`top-0 left-0 border-t-2 border-l-2 transition-opacity duration-300 ${isActive ? 'opacity-100' : 'opacity-0'}`} />
                <CornerBracket className={`top-0 right-0 border-t-2 border-r-2 transition-opacity duration-300 ${isActive ? 'opacity-100' : 'opacity-0'}`} />
                <CornerBracket className={`bottom-0 left-0 border-b-2 border-l-2 transition-opacity duration-300 ${isActive ? 'opacity-100' : 'opacity-0'}`} />
                <CornerBracket className={`bottom-0 right-0 border-b-2 border-r-2 transition-opacity duration-300 ${isActive ? 'opacity-100' : 'opacity-0'}`} />
                
                <h2
                  className={`
                    transition-all duration-300 py-2 px-4
                    ${
                      isActive
                        ? 'text-gray-900 font-semibold text-3xl' // Active text is larger, darker
                        : 'text-gray-400 font-medium text-2xl group-hover:text-gray-500' // Inactive text
                    }
                  `}
                >
                  {scene.title}
                </h2>
              </div>
            );
          })}
        </div>
        
        {/* Divider */}
        <hr className="border-gray-200 w-1/4 mb-8" />
        
        {/* Render active subtitle */}
        <div className="h-24"> {/* Fixed height container to prevent layout jank */}
          <p 
            key={activeScene} /* This key-prop forces re-mount for animation */
            className="text-lg text-gray-500 fade-in"
          >
            {activeSceneData.subtitle}
          </p>
        </div>
      </div>
    </div>
  );
};


/*
 * =======================================================================
 * MAIN COMPONENT: App
 * =======================================================================
 */
export default function App() {
  const [activeScene, setActiveScene] = useState(1);
  const [isThrottled, setIsThrottled] =D = useState(false);
  const throttleDelay = 800; // ms

  const handleWheel = (e) => {
    e.preventDefault();
    if (isThrottled) return;
    setIsThrottled(true);

    if (e.deltaY > 0) {
      setActiveScene((prev) => Math.min(prev + 1, 5));
    } else if (e.deltaY < 0) {
      setActiveScene((prev) => Math.max(prev - 1, 1));
    }

    setTimeout(() => {
      setIsThrottled(false);
    }, throttleDelay);
  };

  return (
    // This main container captures the wheel event and prevents page scroll
    // Updated to light theme and mono font
    <div
      className="bg-gray-100 text-gray-900 font-mono h-screen w-screen overflow-hidden"
      onWheel={handleWheel}
    >
      <StyleInjector />

      <main className="flex flex-col md:flex-row h-full w-full">
        {/* Left Pane (Visuals) */}
        <VisualPane activeScene={activeScene} />

        {/* Right Pane (Text Content) */}
        <TextPane activeScene={activeScene} />
      </main>
    </div>
  );
}