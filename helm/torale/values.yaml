# Default values for torale
# This is a YAML-formatted file.

# Global settings
global:
  projectId: baldmaninc
  region: us-central1

# Domain configuration
domains:
  frontend: torale.ai
  api: api.torale.ai
  docs: docs.torale.ai

# Clerk authentication
clerk:
  publishableKey: pk_test_cGxlYXNhbnQtcHJpbWF0ZS04OC5jbGVyay5hY2NvdW50cy5kZXYk

# Image configuration
image:
  registry: gcr.io
  repository: baldmaninc
  pullPolicy: Always
  # Overrides the image tag whose default is the chart appVersion.
  tag: "latest"

# API deployment
api:
  enabled: true
  replicaCount: 2

  image:
    name: torale-api

  # Cost optimization: Use Spot pods
  nodeSelector:
    cloud.google.com/gke-spot: "true"

  tolerations:
    - key: cloud.google.com/gke-spot
      operator: Equal
      value: "true"
      effect: NoSchedule

  # Right-size resources for cost optimization
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 5
    periodSeconds: 5

  service:
    type: ClusterIP
    port: 80
    targetPort: 8000

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

# Worker deployment
worker:
  enabled: true
  replicaCount: 2

  image:
    name: torale-worker

  # Cost optimization: Use Spot pods
  nodeSelector:
    cloud.google.com/gke-spot: "true"

  tolerations:
    - key: cloud.google.com/gke-spot
      operator: Equal
      value: "true"
      effect: NoSchedule

  # Right-size resources
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

# Frontend deployment
frontend:
  enabled: true
  replicaCount: 2

  image:
    name: torale-frontend

  # Cost optimization: Use Spot pods
  nodeSelector:
    cloud.google.com/gke-spot: "true"

  tolerations:
    - key: cloud.google.com/gke-spot
      operator: Equal
      value: "true"
      effect: NoSchedule

  # Lightweight resources for nginx
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  service:
    type: ClusterIP
    port: 80
    targetPort: 80

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

# Docs deployment
docs:
  enabled: true
  replicaCount: 2

  image:
    name: torale-docs

  # Cost optimization: Use Spot pods
  nodeSelector:
    cloud.google.com/gke-spot: "true"

  tolerations:
    - key: cloud.google.com/gke-spot
      operator: Equal
      value: "true"
      effect: NoSchedule

  # Lightweight resources for nginx
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  service:
    type: ClusterIP
    port: 80
    targetPort: 80

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Database configuration (Cloud SQL)
database:
  # Cloud SQL instance connection name
  connectionName: "baldmaninc:us-central1:torale-db"
  host: "127.0.0.1"  # Cloud SQL Proxy
  port: 5432
  name: torale
  user: torale
  # Password should be set in secrets

# Cloud SQL Proxy sidecar configuration
cloudsql:
  enabled: true
  image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.19.0
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Temporal configuration
temporal:
  # Can be overridden to point to Temporal Cloud
  host: temporal.temporal.svc.cluster.local:7233
  namespace: default
  taskQueue: torale-tasks
  uiUrl: https://cloud.temporal.io

# Platform capacity limit for beta
capacity:
  maxUsers: 100

# Novu notification configuration
novu:
  apiUrl: "https://eu.api.novu.co"
  workflowId: "torale-condition-met"
  verificationWorkflowId: "torale-email-verification"
  welcomeWorkflowId: "torale-task-welcome"
  applicationId: "1mO9V2spkNCO"  # Production app ID

# Ingress configuration
ingress:
  enabled: true
  className: gce
  annotations:
    kubernetes.io/ingress.class: "gce"
    kubernetes.io/ingress.global-static-ip-name: "clusterkit-ingress-ip"
    networking.gke.io/managed-certificates: "torale-cert"
    networking.gke.io/v1beta1.FrontendConfig: "ssl-redirect"
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "false"

  # SSL/TLS configuration
  tls:
    enabled: true
    certificateName: torale-cert

# GKE Managed Certificate
certificate:
  enabled: true
  name: torale-cert

# ConfigMap for non-sensitive configuration
config:
  # Will be populated from values

# Secrets are managed externally (not created by Helm)
# This ensures secrets are never accidentally committed to git and provides
# better separation between infrastructure and application deployment
secrets:
  # Always true - secrets must be created manually before deployment
  # Create secrets using: just k8s-secrets
  # Or manually with kubectl:
  #   kubectl create secret generic torale-secrets -n torale \
  #     --from-literal=GOOGLE_API_KEY="..." \
  #     --from-literal=SECRET_KEY="..." \
  #     --from-literal=DB_PASSWORD="..." \
  #     --from-literal=CLERK_SECRET_KEY="..." \
  #     --from-literal=TEMPORAL_API_KEY="..." \
  #     --from-literal=NOVU_SECRET_KEY="..." \
  #     --from-literal=OPENAI_API_KEY="" \
  #     --from-literal=ANTHROPIC_API_KEY="" \
  #     --from-literal=NOTIFICATION_API_KEY=""
  external: true
  name: torale-secrets

# Service Account (for Workload Identity)
serviceAccount:
  create: true
  name: torale-sa
  annotations:
    iam.gke.io/gcp-service-account: cloudsql-proxy@baldmaninc.iam.gserviceaccount.com
