# frontend/src/components/LandingParallax.tsx
import { useRef } from "react";
import { motion, useTransform } from "framer-motion";
import { Link } from "react-router-dom";
import { useAuth } from "@/contexts/AuthContext";
import { ParticleBackground } from "./ParticleBackground";
import { SystemVisualization } from "./SystemVisualization";
import { CodeTabs } from "./CodeTabs";
import { CapacityBadge } from "./CapacityBadge";
import { useScrollProgress } from "@/hooks/useScrollProgress";

export default function LandingParallax() {
  const { isAuthenticated } = useAuth();
  const containerRef = useRef<HTMLDivElement>(null);

  const {
    heroOpacity,
    heroProgress,
    systemOpacity,
    systemProgress,
    codeOpacity,
    pricingOpacity,
  } = useScrollProgress(containerRef);

  // Particle opacity based on scene
  const particleOpacity = useTransform(
    systemProgress,
    [0, 0.5, 1],
    [1, 0.3, 0.3]
  );

  // Hero transformations
  const heroScale = useTransform(heroProgress, [0, 1], [1, 0.7]);
  const heroY = useTransform(heroProgress, [0, 1], [0, -100]);

  const sceneWrapper =
    "relative h-[170vh] md:h-[190vh] lg:h-[200vh] flex flex-col justify-start";

  return (
    <>
      {/* Particle Background with dynamic opacity */}
      <motion.div
        style={{ opacity: particleOpacity }}
        className="pointer-events-none"
        aria-hidden="true"
      >
        <ParticleBackground />
      </motion.div>

      {/* Main scroll container */}
      <div ref={containerRef} className="relative bg-transparent z-10">
        {/* Scene 1: HERO */}
        <section data-scene="hero" className={sceneWrapper}>
          <motion.div
            style={{ opacity: heroOpacity, scale: heroScale, y: heroY }}
            className="sticky top-0 min-h-screen flex flex-col items-center justify-center px-4"
          >
            <div className="max-w-4xl w-full text-center space-y-8">
              <CapacityBadge />

              <h1 className="text-5xl md:text-7xl font-bold">
                Make the web work for{" "}
                <span className="blinking-underscore">you</span>
              </h1>

              <p className="text-xl text-brand-grey">
                Grounded AI monitoring that watches the web, so you don't have
                to.
              </p>

              <div className="flex flex-col sm:flex-row gap-4 justify-center">
                {isAuthenticated ? (
                  <Link
                    to="/dashboard"
                    className="bg-brand-red text-white uppercase font-bold py-3 px-6 text-sm tracking-wide text-center"
                  >
                    [ + Go to Dashboard ]
                  </Link>
                ) : (
                  <Link
                    to="/sign-up"
                    className="bg-brand-red text-white uppercase font-bold py-3 px-6 text-sm tracking-wide text-center"
                  >
                    [ + Get Started ]
                  </Link>
                )}
                <a
                  href="https://github.com/prassanna-ravishankar/torale"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="bg-white text-black border border-black uppercase font-bold py-3 px-6 text-sm tracking-wide text-center"
                >
                  [ + View on Github ]
                </a>
              </div>
            </div>
          </motion.div>
        </section>

        {/* Scene 2: SYSTEM */}
        <section data-scene="system" className={sceneWrapper}>
          <motion.div
            style={{ opacity: systemOpacity }}
            className="sticky top-0 min-h-screen bg-white border-y-2 border-brand-grid flex items-center"
          >
            <SystemVisualization progress={systemProgress} />
          </motion.div>
        </section>

        {/* Scene 3: CODE */}
        <section data-scene="code" className={sceneWrapper}>
          <motion.div
            style={{ opacity: codeOpacity }}
            className="sticky top-0 min-h-screen flex items-center justify-center bg-white border-y-2 border-brand-grid p-8"
          >
            <div className="max-w-4xl w-full space-y-8">
              <div className="text-center">
                <h2 className="text-3xl font-bold mb-4 uppercase tracking-wide font-mono">
                  [ BUILT FOR DEVELOPERS ]
                </h2>
                <p className="text-brand-grey">
                  Create, manage, and monitor from your terminal.
                </p>
              </div>
              <CodeTabs />
            </div>
          </motion.div>
        </section>

        {/* Scene 4: PRICING */}
        <section data-scene="pricing" className={sceneWrapper}>
          <motion.div
            style={{ opacity: pricingOpacity }}
            className="sticky top-0 min-h-screen flex items-center justify-center bg-white p-8"
          >
            <div className="max-w-md w-full border-2 border-black p-8 text-center bg-white">
              <h3 className="font-bold text-2xl mb-2">Free</h3>
              <p className="text-lg text-brand-grey mb-6">
                "Free till I figure things out."
              </p>
              <ul className="space-y-2 mb-6 text-left">
                <li className="flex items-center gap-2 font-mono text-sm">
                  <span className="text-brand-red">[+]</span> Open-Source
                </li>
                <li className="flex items-center gap-2 font-mono text-sm">
                  <span className="text-brand-red">[+]</span> Unlimited Monitors
                </li>
                <li className="flex items-center gap-2 font-mono text-sm">
                  <span className="text-brand-red">[+]</span> Community Support
                </li>
              </ul>
              <Link
                to="/sign-up"
                className="bg-black text-white uppercase font-bold py-3 px-6 text-sm tracking-wide w-full text-center block"
              >
                [ + Get Started for Free ]
              </Link>
            </div>
          </motion.div>
        </section>

        {/* Scene 5: FOOTER */}
        <footer className="p-6 md:p-12 bg-white border-t border-brand-grid">
          <div className="text-center text-sm text-brand-grey space-y-2">
            <p>Ï„orale is an open-source project.</p>
            <div className="flex justify-center gap-6 font-mono">
              <a
                href="https://github.com/prassanna-ravishankar/torale"
                target="_blank"
                rel="noopener noreferrer"
                className="hover:text-brand-red"
              >
                GitHub
              </a>
              <Link to="/changelog" className="hover:text-brand-red">
                Changelog
              </Link>
            </div>
          </div>
        </footer>
      </div>
    </>
  );
}

# frontend/src/components/ParticleBackground.tsx
import { useEffect, useRef } from 'react';
import * as THREE from 'three';

export function ParticleBackground() {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    if (!canvasRef.current) return;

    const canvas = canvasRef.current;
    let scene: THREE.Scene;
    let camera: THREE.PerspectiveCamera;
    let renderer: THREE.WebGLRenderer;
    let particles: THREE.Points;
    let animationId: number;

    // Determine particle count based on device width
    const isMobile = window.innerWidth < 768;
    const particleCount = isMobile ? 3000 : 10000;
    const flowSpeed = 0.01;

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        100
      );
      camera.position.z = 10;

      renderer = new THREE.WebGLRenderer({
        canvas: canvas,
        alpha: true,
      });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);

      // Particle Geometry
      const geometry = new THREE.BufferGeometry();
      const positions = new Float32Array(particleCount * 3);

      for (let i = 0; i < particleCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 30; // x
        positions[i * 3 + 1] = (Math.random() - 0.5) * 30; // y
        positions[i * 3 + 2] = (Math.random() - 0.5) * 30; // z
      }
      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

      // Particle Material (Glowing Red)
      const material = new THREE.PointsMaterial({
        color: 0xff0000,
        size: 0.025,
        blending: THREE.AdditiveBlending,
        transparent: true,
        opacity: 1.0,
      });

      particles = new THREE.Points(geometry, material);
      scene.add(particles);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
      animationId = requestAnimationFrame(animate);

      // Animate particles
      const positions = (particles.geometry.attributes.position as THREE.BufferAttribute).array as Float32Array;
      for (let i = 0; i < particleCount; i++) {
        // Move particle towards the camera
        positions[i * 3 + 2] += flowSpeed;

        // If particle passes camera, reset its position
        if (positions[i * 3 + 2] > camera.position.z) {
          positions[i * 3] = (Math.random() - 0.5) * 30; // x
          positions[i * 3 + 1] = (Math.random() - 0.5) * 30; // y
          positions[i * 3 + 2] = -15; // Reset back
        }
      }
      particles.geometry.attributes.position.needsUpdate = true;

      // Rotate the whole system slightly for more dynamism
      particles.rotation.y += 0.0001;
      particles.rotation.x += 0.0001;

      renderer.render(scene, camera);
    }

    // Initialize and start animation
    init();
    animate();

    // Add resize listener
    window.addEventListener('resize', onWindowResize, false);

    // Cleanup function
    return () => {
      window.removeEventListener('resize', onWindowResize);
      cancelAnimationFrame(animationId);
      renderer.dispose();
      particles.geometry.dispose();
      (particles.material as THREE.Material).dispose();
    };
  }, []);

  return (
    <>
      <canvas ref={canvasRef} id="particle-vignette-canvas" />
      <div className="vignette-overlay" />
    </>
  );
}

# frontend/src/components/SystemDiagram.tsx
import { motion } from "framer-motion";

interface LayerData {
  id: number;
  title: string;
  yOffset: number;
}

const layers: LayerData[] = [
  { id: 1, title: "FOUNDATION", yOffset: -60 },
  { id: 2, title: "ACQUISITION", yOffset: -20 },
  { id: 3, title: "REASONING", yOffset: 20 },
  { id: 4, title: "SIGNAL", yOffset: 60 },
];

interface SystemDiagramProps {
  activeLayer: number;
}

// 1. Foundation: Live Data Grid with flicker animation
const FoundationVisual = () => (
  <div className="w-full h-full p-3 grid grid-cols-6 gap-1.5">
    {Array.from({ length: 36 }).map((_, i) => (
      <div
        key={i}
        className="w-full h-full bg-black/10"
        style={{
          animation: `flicker 4s infinite`,
          animationDelay: `${Math.random() * 4}s`,
        }}
      />
    ))}
  </div>
);

// 2. Acquisition: Rising Data Pillars
const AcquisitionVisual = () => (
  <div className="w-full h-full p-4 grid grid-cols-3 gap-4">
    {Array.from({ length: 9 }).map((_, i) => (
      <div
        key={i}
        className="w-full h-full bg-black/20"
        style={{
          transformOrigin: "bottom",
          animation: `rise ${2 + Math.random() * 2}s infinite alternate ease-in-out`,
          animationDelay: `${i * 0.2}s`,
        }}
      />
    ))}
  </div>
);

// 3. Reasoning: Active CPU with tracers
const ReasoningVisual = () => (
  <div className="w-full h-full flex items-center justify-center p-4 relative">
    {/* Horizontal tracers */}
    <div
      className="absolute top-1/3 left-0 w-1/4 h-0.5 bg-brand-red"
      style={{ animation: "trace-x 2s linear infinite", animationDelay: "0s" }}
    />
    <div
      className="absolute top-1/2 left-0 w-1/4 h-0.5 bg-brand-red"
      style={{ animation: "trace-x 2s linear infinite", animationDelay: "0.5s" }}
    />
    <div
      className="absolute top-2/3 left-0 w-1/4 h-0.5 bg-brand-red"
      style={{ animation: "trace-x 2s linear infinite", animationDelay: "0.2s" }}
    />
    {/* Vertical tracers */}
    <div
      className="absolute left-1/3 top-0 w-0.5 h-1/4 bg-brand-red"
      style={{ animation: "trace-y 1.8s linear infinite", animationDelay: "0.7s" }}
    />
    <div
      className="absolute left-2/3 top-0 w-0.5 h-1/4 bg-brand-red"
      style={{ animation: "trace-y 1.8s linear infinite", animationDelay: "0.3s" }}
    />

    {/* Chip Body */}
    <div className="w-3/4 h-3/4 bg-black/70 relative flex items-center justify-center">
      {/* Etchings */}
      <div className="absolute w-[90%] h-[90%] border border-black/60" />
      <div className="absolute w-[80%] h-[80%] border border-black/60" />

      {/* Core */}
      <div
        className="w-1/2 h-1/2 bg-black/50 relative z-10"
        style={{ animation: "pulse-core 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite" }}
      />
    </div>
  </div>
);

// 4. Signal: Beacon with expanding rings
const SignalVisual = () => (
  <div className="w-full h-full flex items-center justify-center relative">
    {/* Signal Rings */}
    <div
      className="absolute w-16 h-16 border-2 border-brand-red/70"
      style={{ animation: "signal-ring 2.5s ease-out infinite", animationDelay: "0s" }}
    />
    <div
      className="absolute w-16 h-16 border-2 border-brand-red/70"
      style={{ animation: "signal-ring 2.5s ease-out infinite", animationDelay: "1.25s" }}
    />

    {/* Central Beacon */}
    <div
      className="w-8 h-8 bg-brand-red opacity-90 z-10"
      style={{
        animation: "pulse-core 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite",
        boxShadow: "0 0 20px 10px rgba(255, 0, 0, 0.4)",
      }}
    />
  </div>
);

// Map layer ID to visual component
const LayerVisual = ({ layerId }: { layerId: number }) => {
  switch (layerId) {
    case 1:
      return <FoundationVisual />;
    case 2:
      return <AcquisitionVisual />;
    case 3:
      return <ReasoningVisual />;
    case 4:
      return <SignalVisual />;
    default:
      return null;
  }
};

export function SystemDiagram({ activeLayer }: SystemDiagramProps) {
  return (
    <div className="w-full max-w-md mx-auto font-mono" style={{ perspective: "1000px" }}>
      {/* Vertically stacked layers with 3D transforms */}
      <div className="relative w-64 h-64 mx-auto" style={{ transformStyle: "preserve-3d" }}>
        {layers.map((layer) => {
          const isActive = activeLayer === layer.id;

          return (
            <motion.div
              key={layer.id}
              animate={{
                opacity: isActive ? 1 : 0.3,
                scale: isActive ? 1.05 : 0.9,
              }}
              className="absolute inset-0 w-64 h-64"
              transition={{ duration: 0.7, ease: "easeInOut" }}
            >
              <motion.div
                style={{
                  transform: `rotateX(60deg) rotateZ(-45deg) translateY(${layer.yOffset}px)`,
                  transformStyle: "preserve-3d",
                }}
                animate={{
                  borderColor: isActive ? "#FF0000" : "#000000",
                }}
                className="w-full h-full border-2 bg-white/50 backdrop-blur-sm overflow-hidden transition-all duration-700"
              >
                <LayerVisual layerId={layer.id} />
              </motion.div>
            </motion.div>
          );
        })}
      </div>
    </div>
  );
}

# frontend/src/components/SystemVisualization.tsx
import { useState } from "react";
import { AnimatePresence, motion, MotionValue, useMotionValueEvent } from "framer-motion";
import { SystemDiagram } from "./SystemDiagram";

interface LayerInfo {
  id: number;
  title: string;
  description: string;
}

const layerInfo: LayerInfo[] = [
  {
    id: 0,
    title: "[ MONITORING IS A SYSTEM ]",
    description:
      "Torale runs scheduled searches, LLM analysis, and notifications as a unified, automated system.",
  },
  {
    id: 1,
    title: "[ 1. FOUNDATION ]",
    description:
      "Your search query, condition, and cron schedule form the solid foundation for the entire monitoring task.",
  },
  {
    id: 2,
    title: "[ 2. ACQUISITION ]",
    description:
      "At your scheduled time, Torale executes a grounded Google Search, pulling in real-time data from the live web.",
  },
  {
    id: 3,
    title: "[ 3. REASONING ]",
    description:
      "The LLM 'brain' reasons over the search results, evaluating the raw data against your specific condition.",
  },
  {
    id: 4,
    title: "[ 4. SIGNAL ]",
    description:
      "You get the signal. A single, actionable alert is sent only when your condition is met. No noise.",
  },
];

interface SystemVisualizationProps {
  progress: MotionValue<number>;
}

// Corner bracket component
const CornerBracket = ({ className }: { className: string }) => (
  <div className={`absolute w-3 h-3 border-brand-red ${className}`} />
);

const getLayerFromProgress = (value: number): number => {
  if (value < 0.2) return 0;
  if (value < 0.4) return 1;
  if (value < 0.6) return 2;
  if (value < 0.8) return 3;
  return 4;
};

export function SystemVisualization({ progress }: SystemVisualizationProps) {
  const [activeLayer, setActiveLayer] = useState<LayerInfo["id"]>(0);

  useMotionValueEvent(progress, "change", (value) => {
    const normalized = Math.max(0, Math.min(1, value ?? 0));
    const next = getLayerFromProgress(normalized);
    setActiveLayer((prev) => (prev === next ? prev : next));
  });

  const activeLayerInfo =
    layerInfo.find((layer) => layer.id === activeLayer) ?? layerInfo[0];

  return (
    <div className="h-full flex items-center justify-center p-4 md:p-8">
      <div className="max-w-6xl w-full grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
        {/* Left: Diagram */}
        <div className="flex items-center justify-center">
          <SystemDiagram activeLayer={activeLayer} />
        </div>

        {/* Right: Text Content */}
        <div className="flex items-center justify-center">
          <div className="w-full max-w-lg space-y-6 font-mono">
            {/* Render all titles */}
            <div className="space-y-4">
              {layerInfo.map((layer) => {
                const isActive = activeLayer === layer.id;

                return (
                  <div key={layer.id} className="relative">
                    {/* Corner Brackets - only visible when active */}
                    <motion.div
                      animate={{ opacity: isActive ? 1 : 0 }}
                      transition={{ duration: 0.2 }}
                    >
                      <CornerBracket className="top-0 left-0 border-t-2 border-l-2" />
                      <CornerBracket className="top-0 right-0 border-t-2 border-r-2" />
                      <CornerBracket className="bottom-0 left-0 border-b-2 border-l-2" />
                      <CornerBracket className="bottom-0 right-0 border-b-2 border-r-2" />
                    </motion.div>

                    {/* Title */}
                    <motion.h3
                      animate={{
                        opacity: isActive ? 1 : 0.4,
                        scale: isActive ? 1 : 0.95,
                      }}
                      transition={{ duration: 0.3 }}
                      className="text-xl md:text-2xl font-bold mb-2 tracking-wider py-2 px-4"
                    >
                      {layer.title}
                    </motion.h3>
                  </div>
                );
              })}
            </div>

            {/* Divider */}
            <hr className="border-brand-grid w-1/4" />

            {/* Active description with fade-in animation */}
            <div className="min-h-[80px] relative">
              <AnimatePresence mode="wait">
                <motion.p
                  key={activeLayerInfo.id}
                  initial={{ opacity: 0, y: 12 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -8 }}
                  transition={{ duration: 0.3 }}
                  className="text-brand-grey leading-relaxed"
                >
                  {activeLayerInfo.description}
                </motion.p>
              </AnimatePresence>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

# frontend/src/components/CodeTabs.tsx
import { useState } from 'react';

type CodeTab = 'cli' | 'api' | 'python' | 'self-hosted';

export function CodeTabs() {
  const [activeTab, setActiveTab] = useState<CodeTab>('cli');

  const tabs: { id: CodeTab; label: string }[] = [
    { id: 'cli', label: '[ CLI ]' },
    { id: 'api', label: '[ API (curl) ]' },
    { id: 'python', label: '[ Python SDK ]' },
    { id: 'self-hosted', label: '[ Self-Hosted ]' },
  ];

  const codeExamples: Record<CodeTab, string> = {
    cli: `<span class="text-brand-red">$</span> torale auth set-api-key

<span class="text-brand-red">$</span> torale task create \\
    --query "When is iPhone 16 being released?" \\
    --condition "A specific release date is announced" \\
    --schedule "0 9 * * *" \\
    --notify-behavior once

<span class="text-brand-red">$</span> torale task list`,

    api: `<span class="text-brand-red">$</span> curl -X POST https://api.torale.ai/api/v1/tasks \\
  -H "Authorization: Bearer sk_your_api_key_here" \\
  -H "Content-Type: application/json" \\
  -d '{
    "name": "iPhone Release Monitor",
    "schedule": "0 9 * * *",
    "search_query": "When is iPhone 16 being released?",
    "condition_description": "A specific release date is announced",
    "notify_behavior": "once"
  }'`,

    python: `<span class="text-brand-red">from</span> torale.sdk <span class="text-brand-red">import</span> ToraleClient

client = ToraleClient(
    api_key=<span class="text-green-400">"sk_your_api_key"</span>,
    base_url=<span class="text-green-400">"https://api.torale.ai"</span>
)

task = client.tasks.create(
    name=<span class="text-green-400">"iPhone Release Monitor"</span>,
    search_query=<span class="text-green-400">"When is iPhone 16 being released?"</span>,
    condition_description=<span class="text-green-400">"A specific release date is announced"</span>,
    schedule=<span class="text-green-400">"0 9 * * *"</span>,
    notify_behavior=<span class="text-green-400">"once"</span>
)`,

    'self-hosted': `<span class="text-brand-red"># 1. Clone the repository</span>
<span class="text-brand-red">$</span> git clone https://github.com/prassanna-ravishankar/torale
<span class="text-brand-red">$</span> cd torale

<span class="text-brand-red"># 2. Configure environment</span>
<span class="text-brand-red">$</span> cp .env.example .env
<span class="text-brand-red"># Add your API keys (GOOGLE_API_KEY, etc.)</span>

<span class="text-brand-red"># 3. Start all services</span>
<span class="text-brand-red">$</span> docker compose up -d

<span class="text-brand-red"># 4. Start frontend</span>
<span class="text-brand-red">$</span> cd frontend && npm run dev

<span class="text-brand-red"># 5. Open http://localhost:3000</span>`,
  };

  return (
    <div className="max-w-3xl mx-auto bg-black text-white p-6">
      {/* Code Tabs */}
      <div className="flex gap-x-6 mb-4 font-mono text-sm flex-wrap">
        {tabs.map((tab) => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            className={`code-tab-btn pb-2 transition-colors ${
              activeTab === tab.id
                ? 'code-active-tab text-brand-red'
                : 'text-brand-grey hover:text-white'
            }`}
          >
            {tab.label}
          </button>
        ))}
      </div>

      {/* Code Content */}
      <pre className="font-mono text-sm overflow-x-auto">
        <code
          dangerouslySetInnerHTML={{ __html: codeExamples[activeTab] }}
        />
      </pre>
    </div>
  );
}

# frontend/src/components/CapacityBadge.tsx
import { useEffect, useState } from "react";

export function CapacityBadge() {
  const [availableSlots, setAvailableSlots] = useState<number | null>(null);
  const isFull = availableSlots === 0;

  useEffect(() => {
    const fetchCapacity = async () => {
      try {
        const apiUrl = window.CONFIG?.apiUrl || import.meta.env.VITE_API_BASE_URL;
        if (!apiUrl) {
          console.error("API URL is not set");
          return;
        }
        const response = await fetch(`${apiUrl}/public/stats`);
        if (response.ok) {
          const data = await response.json();
          if (typeof data?.capacity?.available_slots === "number") {
            setAvailableSlots(data.capacity.available_slots);
          }
        }
      } catch (error) {
        console.error("Failed to fetch capacity stats:", error);
      }
    };

    fetchCapacity();
  }, []);

  return (
    <div className="inline-block bg-black text-white px-4 py-2 font-mono text-sm mb-4">
      {isFull
        ? "[ We're at capacity - join the waitlist! ]"
        : availableSlots !== null && availableSlots > 0
        ? `[ Free for ${availableSlots} more user${availableSlots === 1 ? "" : "s"} till I figure out what this is used for ]`
        : "[ Free till I figure out what this is used for ]"}
    </div>
  );
}

# frontend/src/hooks/useScrollProgress.ts
import { useScroll, useTransform, MotionValue } from "framer-motion";
import { RefObject, useLayoutEffect, useState } from "react";

export interface ScrollProgress {
  // Raw scroll progress (0 to 1)
  scrollYProgress: MotionValue<number>;

  // Scene progress values (0 to 1 within each scene)
  heroProgress: MotionValue<number>;
  systemProgress: MotionValue<number>;
  codeProgress: MotionValue<number>;
  pricingProgress: MotionValue<number>;

  // Scene visibility (0 = hidden, 1 = visible)
  heroOpacity: MotionValue<number>;
  systemOpacity: MotionValue<number>;
  codeOpacity: MotionValue<number>;
  pricingOpacity: MotionValue<number>;
}

type SceneKey = "hero" | "system" | "code" | "pricing";

interface SceneRange {
  start: number;
  end: number;
}

type SceneRanges = Record<SceneKey, SceneRange>;

const DEFAULT_RANGES: SceneRanges = {
  hero: { start: 0, end: 0.24 },
  system: { start: 0.24, end: 0.5 },
  code: { start: 0.5, end: 0.76 },
  pricing: { start: 0.76, end: 1 },
};

const clamp01 = (value: number) => Math.min(1, Math.max(0, value));

const useRangeTransform = (
  scrollYProgress: MotionValue<number>,
  range: SceneRange
) =>
  useTransform(scrollYProgress, [range.start, range.end], [0, 1], {
    clamp: true,
  });

const useOpacityTransform = (
  scrollYProgress: MotionValue<number>,
  range: SceneRange,
  fade: number = 0.08,
  keepTailVisible = false
) => {
  const fadeInStart = clamp01(range.start - fade);
  const fadeOutEnd = keepTailVisible ? 1 : clamp01(range.end + fade);

  const input = keepTailVisible
    ? [fadeInStart, range.start, range.end]
    : [fadeInStart, range.start, range.end, fadeOutEnd];

  const output = keepTailVisible ? [0, 1, 1] : [0, 1, 1, 0];

  return useTransform(scrollYProgress, input, output, { clamp: true });
};

export function useScrollProgress(
  containerRef: RefObject<HTMLElement>
): ScrollProgress {
  const { scrollYProgress } = useScroll({
    target: containerRef,
    offset: ["start start", "end end"],
  });

  const [sceneRanges, setSceneRanges] = useState<SceneRanges>(DEFAULT_RANGES);

  useLayoutEffect(() => {
    if (typeof window === "undefined") {
      return;
    }

    const updateRanges = () => {
      const container = containerRef.current;
      if (!container) {
        return;
      }

      const sections = Array.from(
        container.querySelectorAll<HTMLElement>("[data-scene]")
      );

      if (!sections.length) {
        return;
      }

      const scrollableHeight = Math.max(
        container.scrollHeight - window.innerHeight,
        1
      );

      const nextRanges: Partial<SceneRanges> = {};

      sections.forEach((section) => {
        const scene = section.dataset.scene as SceneKey | undefined;
        if (!scene) {
          return;
        }

        const start = clamp01(section.offsetTop / scrollableHeight);
        const end = clamp01(
          (section.offsetTop + section.offsetHeight) / scrollableHeight
        );

        if (end <= start) {
          nextRanges[scene] = {
            start,
            end: clamp01(start + 0.0001),
          };
        } else {
          nextRanges[scene] = { start, end };
        }
      });

      if (Object.keys(nextRanges).length) {
        setSceneRanges((prev) => ({ ...prev, ...nextRanges }));
      }
    };

    updateRanges();
    window.addEventListener("resize", updateRanges);

    return () => {
      window.removeEventListener("resize", updateRanges);
    };
  }, [containerRef]);

  const heroProgress = useRangeTransform(scrollYProgress, sceneRanges.hero);
  const heroOpacity = useOpacityTransform(
    scrollYProgress,
    sceneRanges.hero,
    0.08
  );

  const systemProgress = useRangeTransform(
    scrollYProgress,
    sceneRanges.system
  );
  const systemOpacity = useOpacityTransform(
    scrollYProgress,
    sceneRanges.system
  );

  const codeProgress = useRangeTransform(scrollYProgress, sceneRanges.code);
  const codeOpacity = useOpacityTransform(
    scrollYProgress,
    sceneRanges.code
  );

  const pricingProgress = useRangeTransform(
    scrollYProgress,
    sceneRanges.pricing
  );
  const pricingOpacity = useOpacityTransform(
    scrollYProgress,
    sceneRanges.pricing,
    0.08,
    true
  );

  return {
    scrollYProgress,
    heroProgress,
    systemProgress,
    codeProgress,
    pricingProgress,
    heroOpacity,
    systemOpacity,
    codeOpacity,
    pricingOpacity,
  };
}

# frontend/src/index.css
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Roboto+Mono:wght@400;500&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;
    --radius: 0.5rem;
  }

}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

@layer utilities {
  /* Hide scrollbar for Chrome, Safari and Opera */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
}

/* Landing Page Redesign Styles */

/* Sharp corners everywhere */
* {
  border-radius: 0 !important;
}

/* Full-page particle canvas */
#particle-vignette-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
}

/* Vignette overlay - softer, more visible center */
.vignette-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  background: radial-gradient(circle at 75% 50%,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,0.6) 45%,
    rgba(255,255,255,1) 70%);
  pointer-events: none;
}

/* L-shaped corner brackets for sections */
.agno-section {
  position: relative;
  padding: 4rem 1.5rem;
}
.agno-section-bracket::before,
.agno-section-bracket::after {
  content: '';
  position: absolute;
  width: 30px;
  height: 30px;
}
.agno-section-bracket::before {
  top: 24px;
  left: 24px;
  border-top: 2px solid #000;
  border-left: 2px solid #000;
}
.agno-section-bracket::after {
  bottom: 24px;
  right: 24px;
  border-bottom: 2px solid #000;
  border-right: 2px solid #000;
}

/* Blinking Red Underscore */
.blinking-underscore {
  display: inline;
  position: relative;
}
.blinking-underscore::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: -0.15em;
  width: 100%;
  height: 0.1em;
  background-color: #FF0000;
  animation: blink 1.2s infinite steps(1, start);
}
@keyframes blink {
  50% { background-color: transparent; }
}

/* System visualization layer animations */
@keyframes flicker {
  0%, 100% { opacity: 0.2; }
  20% { opacity: 1; background-color: #FF0000; }
  30% { opacity: 0.4; }
  50% { opacity: 0.8; background-color: #fca5a5; }
  70% { opacity: 0.3; }
}

@keyframes rise {
  from { transform: scaleY(0.05); }
  to { transform: scaleY(1); }
}

@keyframes trace-x {
  from { transform: translateX(-100%); }
  to { transform: translateX(400%); }
}

@keyframes trace-y {
  from { transform: translateY(-100%); }
  to { transform: translateY(400%); }
}

@keyframes pulse-core {
  0%, 100% { opacity: 0.7; transform: scale(0.95); }
  50% { opacity: 1; transform: scale(1.05); }
}

@keyframes signal-ring {
  from {
    transform: scale(0.5);
    opacity: 0.7;
  }
  to {
    transform: scale(2.5);
    opacity: 0;
  }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Section fade-in on scroll */
.fade-in-section {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  will-change: opacity, transform;
}
.fade-in-section.is-visible {
  opacity: 1;
  transform: translateY(0);
}

/* Code tabs */
.code-tab-btn.code-active-tab {
  color: #FF0000;
  border-bottom: 1px solid #FF0000;
}
.code-tab-btn {
  border-bottom: 1px solid transparent;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  #particle-vignette-canvas {
    display: none;
  }
  .vignette-overlay {
    background: none;
  }
  .fade-in-section {
    opacity: 1;
    transform: none;
    transition: none;
  }
}

# frontend/tailwind.config.js
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
    "./node_modules/neocron/dist/**/*.{js,mjs}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
        mono: ['Roboto Mono', 'monospace'],
      },
      colors: {
        'brand-red': '#FF0000',
        'brand-grid': '#F0F0F0',
        'brand-grey': '#666666',
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}
